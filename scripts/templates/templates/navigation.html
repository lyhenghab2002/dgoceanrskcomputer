<header>
  <div class="top-bar">
    <div class="top-header">
      <div class="logo-left">
    <a href="{{ url_for('show_dashboard') }}">
        <img src="/static/icons/logo.jpg" alt="Company Logo" class="logo" />
    </a>
</div>

      <div class="site-title">Russeykeo Computer</div>
      <!-- Hamburger button visible only on mobile -->
      <button
        class="nav-toggle"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
      >
        &#9776;
      </button>
    </div>
    <nav>
      <ul>
        <li><a href="{{ url_for('show_dashboard') }}">Home</a></li>

        <li>
          <a href="#" class="dropdown-link" aria-haspopup="true" aria-expanded="false">Categories</a>
          <ul class="dropdown" id="categories-dropdown">
            <!-- Categories will be loaded dynamically -->
          </ul>
        </li>
        <li>
          <a href="#" class="dropdown-link" aria-haspopup="true" aria-expanded="false">Products</a>
          <ul class="dropdown">
            <li><a href="/products/brand/dell">Dell</a></li>
            <li><a href="/products/brand/hp">HP</a></li>
            <li><a href="/products/brand/lenovo">Lenovo</a></li>
            <li><a href="/products/brand/asus">Asus</a></li>
            <li><a href="/products/brand/acer">Acer</a></li>
            <li><a href="/products/brand/razer">Razer</a></li>
          </ul>
        </li>
        <li>
          <a href="#" class="dropdown-link" aria-haspopup="true" aria-expanded="false">About Company</a>

          <ul class="dropdown">
            <li><a href="{{ url_for('about') }}">About Us</a></li>
            <!-- <li><a href="{{ url_for('services') }}">Our Services</a></li>
            <li><a href="{{ url_for('privacy') }}">Privacy Policy</a></li> -->
          </ul>
        </li>
                                   <li>
            <a href="{{ url_for('cart') }}" id="cart-link" class="cart-link">
              <div class="cart-icon-container">
                <i class="bi bi-cart3" style="font-size: 24px; margin-right: 8px;"></i>
                <span id="cart-badge" class="cart-badge">0</span>
              </div>
              My Cart
            </a>
                        
          </li>
        {% if not session.username %}
        <li><a href="{{ url_for('auth.register') }}">Create Account</a></li>
        {% endif %}
        {% if session.username %}
          {% if session.role == 'customer' %}
          <li data-role="customer">
            <a href="#" onclick="showNotifications()" id="notifications-link">
              Notifications
              <span
                id="notification-badge"
                class="notification-badge"
                style="display: none;"
                >0</span
              >
            </a>
          </li>
          {% elif session.role in ['staff', 'admin', 'super_admin'] %}
          <li>
            <a href="#" onclick="showNotifications()" id="notifications-link">
              Notifications
              <span
                id="notification-badge"
                class="notification-badge"
                style="display: none;"
                >0</span
              >
            </a>
          </li>
          {% endif %}
        {% endif %}
        {% if session.username %}
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle d-flex align-items-center text-white"
            href="#"
            id="userDropdown"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="bi bi-person-circle me-2"></i>
            <span class="username-text">{{ session.username }}</span>
          </a>
          <ul
            class="dropdown-menu dropdown-menu-end custom-dropdown"
            aria-labelledby="userDropdown"
          >
            {% if session.role == 'customer' %}
            <li>
              <a class="dropdown-item" href="{{ url_for('customer_preorders') }}">
                <i class="bi bi-list-check me-2"></i>My Pre-Orders
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="{{ url_for('customer_account') }}">
                <i class="bi bi-person me-2"></i>My Account
              </a>
            </li>
            {% elif session.role in ['staff', 'admin', 'super_admin'] %}
            <li>
              <a class="dropdown-item" href="{{ url_for('customer_preorders') }}">
                <i class="bi bi-list-check me-2"></i>My Pre-Orders
              </a>
            </li>
            {% endif %}
            <li><hr class="dropdown-divider" /></li>
            <li>
              <a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"
                ><i class="bi bi-box-arrow-right me-2"></i>Logout</a
              >
            </li>
          </ul>
        </li>
        {% else %}
        <li class="nav-item">
          <a
            href="/auth/login"
            class="btn btn-outline-light btn-sm d-flex align-items-center"
          >
            <i class="bi bi-person-plus me-2"></i> Login Account
          </a>
        </li>
        {% endif %}
        <li>
          <form
            class="search-container"
            action="/search"
            method="GET"
            onsubmit="return validateSearch()"
          >
            <button
              type="button"
              class="search-icon"
              tabindex="0"
              aria-label="Search products"
              style="background:none; border:none; padding:0; cursor:pointer;"
            >
              <img
                src="/static/icons/search.png"
                alt="Search Icon"
                style="height: 20px"
              />
            </button>
            <input
              type="text"
              name="q"
              class="search-input"
              placeholder="Search..."
              aria-label="Search products"
              required
            />
            <div class="search-suggestions"></div>
          </form>
        </li>
      </ul>
    </nav>
  </div>
</header>

<script>
// Add dropdown functionality for navigation
document.addEventListener('DOMContentLoaded', function() {
    const dropdownLinks = document.querySelectorAll('.dropdown-link');
    
    dropdownLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Close all other dropdowns
            dropdownLinks.forEach(otherLink => {
                if (otherLink !== link) {
                    otherLink.setAttribute('aria-expanded', 'false');
                }
            });
            
            // Toggle current dropdown
            const isExpanded = this.getAttribute('aria-expanded') === 'true';
            this.setAttribute('aria-expanded', !isExpanded);
        });

        // Add hover events to show/hide dropdown
        link.addEventListener('mouseenter', function() {
            this.setAttribute('aria-expanded', 'true');
        });

        link.addEventListener('mouseleave', function() {
            this.setAttribute('aria-expanded', 'false');
        });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.dropdown-link') && !e.target.closest('.dropdown')) {
            dropdownLinks.forEach(link => {
                link.setAttribute('aria-expanded', 'false');
            });
        }
    });

    // Load categories for dropdown
    loadCategories();
});

async function loadCategories() {
    try {
        const response = await fetch('/api/navigation/categories');
        if (response.ok) {
            const data = await response.json();
            if (data.categories) {
                populateCategoriesDropdown(data.categories);
            }
        }
    } catch (error) {
        console.error('Error loading navigation categories:', error);
    }
}

function populateCategoriesDropdown(categories) {
    const dropdown = document.getElementById('categories-dropdown');
    if (!dropdown) return;

    dropdown.innerHTML = '';
    
    // Define sub-subcategories for each main category
    const subcategories = {
        'Laptops': [
            { name: 'Gaming Laptops', url: '/category/laptops/gaming' },
            { name: 'Business Laptops', url: '/category/laptops/business' },
            { name: 'Student Laptops', url: '/category/laptops/student' },
            { name: 'Ultrabooks', url: '/category/laptops/ultrabooks' }
        ],
        'Desktops': [
            { name: 'Gaming PCs', url: '/category/desktops/gaming' },
            { name: 'Workstations', url: '/category/desktops/workstations' },
            { name: 'All-in-One PCs', url: '/category/desktops/all-in-one' },
            { name: 'Mini PCs', url: '/category/desktops/mini' }
        ],
        'Accessories': [
            { name: 'Keyboards', url: '/category/accessories/keyboards' },
            { name: 'Mice', url: '/category/accessories/mice' },
            { name: 'Monitors', url: '/category/accessories/monitors' },
            { name: 'Cables & Adapters', url: '/category/accessories/cables' }
        ]
    };
    
    categories.forEach(category => {
        // Create main category item
        const mainLi = document.createElement('li');
        mainLi.className = 'dropdown-parent';
        
        const mainA = document.createElement('a');
        mainA.href = `/category/${category.id}`;
        mainA.textContent = category.name;
        mainA.className = 'dropdown-main-link';
        mainLi.appendChild(mainA);
        
        // Add sub-subcategories if they exist
        if (subcategories[category.name]) {
            const subUl = document.createElement('ul');
            subUl.className = 'dropdown-submenu';
            
            subcategories[category.name].forEach(subcat => {
                const subLi = document.createElement('li');
                const subA = document.createElement('a');
                subA.href = subcat.url;
                subA.textContent = subcat.name;
                subA.className = 'dropdown-sub-link';
                subLi.appendChild(subA);
                subUl.appendChild(subLi);
            });
            
            mainLi.appendChild(subUl);
        }
        
        dropdown.appendChild(mainLi);
    });
}
</script>